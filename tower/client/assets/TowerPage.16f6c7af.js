import{j as v,B as p,u as C,C as T,c as d,b as I,d as s,e as c,f as t,h as m,t as l,F as g,E as k,w as S,v as j,p as A,i as B,G as D,_ as w,n as E}from"./vendor.c352f31b.js";import{_ as N,P as h,l as f,c as P,t as b,A as r}from"./index.4d261c08.js";import{t as V}from"./TicketsService.5fd91b29.js";const F={setup(){const a=v({}),i=p(),y=C(),e=v(""),u=v(null);return T(async()=>{(e.value||u.value)&&(await b.getTowerById(r.activeTower.id),e.value="",u.value=null)}),{canceled:u,submission:a,attendees:d(()=>r.tickets.filter(o=>o.eventId==i.params.id)),date:d(()=>new Date(r.activeTower.startDate).toLocaleString().split(",")),tower:d(()=>r.activeTower),tickets:d(()=>r.tickets),isAttending:d(()=>r.tickets.find(o=>o.eventId==r.activeTower.id&&o.accountId==r.account.id)),account:d(()=>r.account),comments:d(()=>r.comments),async createTicket(){try{const o={eventId:this.tower.id,accountId:this.account.id};if(!this.isAttending)await V.createTicket(o),h.toast("Spot confirmed","success"),e.value="bought";else throw new Error("You cannot reserve more than one ticket for an event")}catch(o){f.error(o),h.toast(o.message,"error")}},async addComment(){try{a.value.creatorId=this.account.id,a.value.eventId=i.params.id,await P.addComment(a.value),a.value={}}catch(o){f.error(o),h.toast(o.message,"error")}},async cancelTower(){try{await h.confirm("Are you sure?","This event will be canceled or deleted permanently.")&&(await b.handleCancel(this.account.id,this.tower.id)=="deleted"?y.push({name:"Home"}):(h.toast("Your event has been canceled"),u.value=!0))}catch(o){f.error(o),h.toast(o.message,"error")}}}}},_=a=>(A("data-v-186f0612"),a=a(),B(),a),L=w+"#x-circle",R=w+"#hourglass-split",Y=w+"#bookmark",G={class:"container-fluid"},H={class:"row d-flex justify-content-center"},J={class:"col-12"},M={class:"tower-details d-flex bg-light m-2 p-2",style:{position:"relative"}},O={key:0,class:"canceled-overlay"},U=["src"],q=["id"],z=_(()=>t("svg",{class:"bi",width:"32",height:"32",fill:"currentColor"},[t("use",{"xlink:href":L})],-1)),K=[z],Q={class:"tower-info w-100 p-3 d-flex flex-column"},W={class:"d-flex justify-content-between align-items-center"},X={class:"d-flex flex-column align-items-start"},Z={class:"d-flex flex-column align-items-end"},$=_(()=>t("hr",{class:"my-1"},null,-1)),ee={class:"description"},te={class:"m-0"},oe={class:"d-flex justify-content-between mt-auto align-items-end"},se={key:0,class:"d-flex align-items-end"},ce={key:0,class:"mb-0 me-2"},ne={key:1,class:"mb-0 me-2"},ie=_(()=>t("i",null,[t("svg",{class:"bi",width:"18",height:"18",fill:"currentColor"},[t("use",{"xlink:href":R})])],-1)),ae={key:1},re=E(" Attend "),le=_(()=>t("svg",{class:"bi",width:"32",height:"32",fill:"currentColor"},[t("use",{"xlink:href":Y})],-1)),de=[re,le],me={key:3},_e=_(()=>t("strong",null,"Canceled!",-1)),he=[_e],ue={class:"col-md-12"},ve={class:"d-flex flex-wrap attendees bg-light m-2 p-1"},we=["src","title"],fe={class:"col-10"},ye={key:0,class:"comments-section bg-light p-2"},ge={class:""},ke=_(()=>t("div",null,[t("p")],-1)),be={class:"mb-3"},xe=_(()=>t("label",{for:"new-comment",class:"form-label"},"Join the conversation",-1)),pe={class:"w-100 d-flex justify-content-end"};function Ce(a,i,y,e,u,o){const x=I("Comment");return s(),c("div",G,[t("div",H,[t("div",J,[t("div",M,[e.tower.isCanceled?(s(),c("div",O)):m("",!0),t("img",{class:"",src:e.tower.coverImg,alt:""},null,8,U),!e.tower.isCanceled&&e.account.id==e.tower.creatorId?(s(),c("i",{key:1,onClick:i[0]||(i[0]=(...n)=>e.cancelTower&&e.cancelTower(...n)),id:"canceller-"+e.tower.id,class:"canceller rounded-circle selectable on-hover"},K,8,q)):m("",!0),t("div",Q,[t("div",W,[t("div",X,[t("h3",null,l(e.tower.name),1),t("h5",null,l(e.tower.location),1)]),t("div",Z,[t("h6",null,"-- "+l(e.tower.type)+" --",1),t("h5",null,l(e.date[0]),1),t("h6",null,"Doors at "+l(e.date[1]),1)])]),$,t("div",ee,[t("p",te,l(e.tower.description),1)]),t("div",oe,[e.tower.capacity!=0&&!e.tower.isCanceled?(s(),c("div",se,[e.tower.capacity==1?(s(),c("h6",ce,l(e.tower.capacity)+" spot left ",1)):(s(),c("h6",ne,l(e.tower.capacity)+" spots left ",1)),ie])):m("",!0),e.tower.capacity==0&&!e.tower.isCanceled?(s(),c("h6",ae,"Sold Out!")):m("",!0),e.account.id&&e.tower.capacity!==0&&!e.isAttending&&!e.tower.isCanceled&&e.tower.creatorId!=e.account.id?(s(),c("button",{key:2,class:"",onClick:i[1]||(i[1]=n=>e.createTicket())},de)):m("",!0),e.tower.isCanceled?(s(),c("div",me,he)):m("",!0)])])])]),t("div",ue,[t("div",ve,[(s(!0),c(g,null,k(e.attendees,n=>(s(),c("img",{key:n.accountId,src:n.account.picture,class:"attendeesImg rounded-circle me-1",alt:"user-img",title:n.account.name},null,8,we))),128))])]),t("div",fe,[e.account.id?(s(),c("div",ye,[t("div",ge,[ke,t("div",be,[xe,S(t("textarea",{type:"text",class:"form-control",name:"new-comment",id:"comment-textarea","aria-label":"New Comment",placeholder:"Type your comment here","onUpdate:modelValue":i[2]||(i[2]=n=>e.submission.body=n)},null,512),[[j,e.submission.body]]),t("div",pe,[t("button",{class:"",type:"submit",for:"comment-textarea",onClick:i[3]||(i[3]=n=>e.addComment())}," post comment ")])]),(s(!0),c(g,null,k(e.comments,n=>(s(),D(x,{key:n.id,comment:n},null,8,["comment"]))),128))])])):m("",!0)])])])}var je=N(F,[["render",Ce],["__scopeId","data-v-186f0612"]]);export{je as default};
