import{j as v,B as p,u as C,C as I,c as m,b as T,d as s,e as c,f as t,I as S,h as _,t as d,F as g,E as b,w as j,v as A,p as B,i as D,G as P,_ as w,n as E}from"./vendor.aca7b170.js";import{_ as N,P as h,l as f,c as V,t as k,A as r}from"./index.b957e9a8.js";import{t as F}from"./TicketsService.8909a483.js";const L={setup(){const i=v({}),a=p(),y=C(),e=v(""),u=v(null);return I(async()=>{(e.value||u.value)&&(await k.getTowerById(r.activeTower.id),e.value="",u.value=null)}),{canceled:u,submission:i,attendees:m(()=>r.tickets.filter(o=>o.eventId==a.params.id)),date:m(()=>new Date(r.activeTower.startDate).toLocaleString().split(",")),tower:m(()=>r.activeTower),tickets:m(()=>r.tickets),isAttending:m(()=>r.tickets.find(o=>o.eventId==r.activeTower.id&&o.accountId==r.account.id)),account:m(()=>r.account),comments:m(()=>r.comments),async createTicket(){try{const o={eventId:this.tower.id,accountId:this.account.id};if(!this.isAttending)await F.createTicket(o),h.toast("Spot confirmed","success"),e.value="bought";else throw new Error("You cannot reserve more than one ticket for an event")}catch(o){f.error(o),h.toast(o.message,"error")}},async addComment(){try{i.value.creatorId=this.account.id,i.value.eventId=a.params.id,await V.addComment(i.value),i.value={}}catch(o){f.error(o),h.toast(o.message,"error")}},async cancelTower(){try{await h.confirm("Are you sure?","This event will be canceled or deleted permanently.")&&(await k.handleCancel(this.account.id,this.tower.id)=="deleted"?y.push({name:"Home"}):(h.toast("Your event has been canceled"),u.value=!0))}catch(o){f.error(o),h.toast(o.message,"error")}}}}},l=i=>(B("data-v-3e633db2"),i=i(),D(),i),R=w+"#x-circle",Y=w+"#hourglass-split",z=w+"#bookmark",G={class:"container-fluid"},H={class:"row d-flex justify-content-center"},J={class:"col-12"},M={key:0,class:"canceled-overlay"},O=l(()=>t("div",{class:"tower-coverImg"},null,-1)),U=["id"],q=l(()=>t("svg",{class:"bi",width:"32",height:"32",fill:"currentColor"},[t("use",{"xlink:href":R})],-1)),K=[q],Q={class:"tower-info w-100 p-3 d-flex flex-column"},W={class:"d-flex justify-content-between align-items-center"},X={class:"d-flex flex-column align-items-start"},Z={class:"d-flex flex-column align-items-end"},$=l(()=>t("hr",{class:"my-1"},null,-1)),ee={class:"description"},te={class:"m-0"},oe={class:"d-flex justify-content-between mt-auto align-items-end"},se={key:0,class:"numbers-info"},ce={key:0,class:"me-2"},ne={key:1,class:"me-2"},ae=l(()=>t("i",null,[t("svg",{class:"bi",width:"18",height:"18",fill:"currentColor"},[t("use",{"xlink:href":Y})])],-1)),ie={key:1},re=E(" Attend "),le=l(()=>t("svg",{class:"bi",width:"32",height:"32",fill:"currentColor"},[t("use",{"xlink:href":z})],-1)),de=[re,le],me={key:3},_e=l(()=>t("strong",null,"Canceled!",-1)),he=[_e],ue={class:"col-md-12"},ve={class:"d-flex flex-wrap attendees bg-light m-2 p-1"},we=["src","title"],fe={class:"col-10"},ye={key:0,class:"comments-section bg-light p-2"},ge={class:""},be=l(()=>t("div",null,[t("p")],-1)),ke={class:"mb-3"},xe=l(()=>t("label",{for:"new-comment",class:"ms-2 form-label"},"Join the conversation",-1)),pe={class:"w-100 d-flex justify-content-end"},Ce=l(()=>t("div",{class:"row"},[t("div",{class:"col-12"},[t("div",{style:{height:"5vh"}})])],-1));function Ie(i,a,y,e,u,o){const x=T("Comment");return s(),c("div",G,[t("div",H,[t("div",J,[t("div",{class:"tower-details d-flex bg-light m-2 p-2",style:S("background-image: url("+e.tower.coverImg+")")},[e.tower.isCanceled?(s(),c("div",M)):_("",!0),O,!e.tower.isCanceled&&e.account.id==e.tower.creatorId?(s(),c("i",{key:1,onClick:a[0]||(a[0]=(...n)=>e.cancelTower&&e.cancelTower(...n)),id:"canceller-"+e.tower.id,class:"canceller rounded-circle selectable on-hover"},K,8,U)):_("",!0),t("div",Q,[t("div",W,[t("div",X,[t("h3",null,d(e.tower.name),1),t("h5",null,d(e.tower.location),1)]),t("div",Z,[t("h6",null,"-- "+d(e.tower.type)+" --",1),t("h5",null,d(e.date[0]),1),t("h6",null,"Doors at "+d(e.date[1]),1)])]),$,t("div",ee,[t("p",te,d(e.tower.description),1)]),t("div",oe,[e.tower.capacity!=0&&!e.tower.isCanceled?(s(),c("div",se,[e.tower.capacity==1?(s(),c("span",ce,d(e.tower.capacity)+" spot left ",1)):(s(),c("span",ne,d(e.tower.capacity)+" spots left ",1)),ae])):_("",!0),e.tower.capacity==0&&!e.tower.isCanceled?(s(),c("h6",ie,"Sold Out!")):_("",!0),e.account.id&&e.tower.capacity!==0&&!e.isAttending&&!e.tower.isCanceled&&e.tower.creatorId!=e.account.id?(s(),c("button",{key:2,class:"",onClick:a[1]||(a[1]=n=>e.createTicket())},de)):_("",!0),e.tower.isCanceled?(s(),c("div",me,he)):_("",!0)])])],4)]),t("div",ue,[t("div",ve,[(s(!0),c(g,null,b(e.attendees,n=>(s(),c("img",{key:n.accountId,src:n.account.picture,class:"attendeesImg rounded-circle me-1",alt:"user-img",title:n.account.name},null,8,we))),128))])]),t("div",fe,[e.account.id?(s(),c("div",ye,[t("div",ge,[be,t("div",ke,[xe,j(t("textarea",{type:"text",class:"form-control",name:"new-comment",id:"comment-textarea","aria-label":"New Comment",placeholder:"Type your comment here","onUpdate:modelValue":a[2]||(a[2]=n=>e.submission.body=n)},null,512),[[A,e.submission.body]]),t("div",pe,[t("button",{class:"btn btn-warning mt-2",type:"submit",for:"comment-textarea",onClick:a[3]||(a[3]=n=>e.addComment())}," Post Comment ")])]),(s(!0),c(g,null,b(e.comments,n=>(s(),P(x,{key:n.id,comment:n},null,8,["comment"]))),128))])])):_("",!0)])]),Ce])}var Ae=N(L,[["render",Ie],["__scopeId","data-v-3e633db2"]]);export{Ae as default};
